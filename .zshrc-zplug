# Known issues:
# Slow to start up.

export GENCOMPL_FPATH=~/dotfiles/completions
export HISTFILE=/home/arsham/Dropbox/Home/.zsh_history
export HISTSIZE=999999999
export SAVEHIST=$HISTSIZE
export LANG=en_GB.UTF-8
export LC_CTYPE=en_GB.UTF8
export EDITOR=nano
export VISUAL=nano

. ~/dotfiles/zsh_conf/powerlevel9k.zsh-theme
export fpath=(~/dotfiles/functions "${fpath[@]}")

export ZPLUG_HOME=$HOME/.zplug
[[ -d ~/.zplug ]] || {
  mkdir -p $ZPLUG_HOME
  git clone https://github.com/zplug/zplug $ZPLUG_HOME
  source ~/.zplug/init.zsh && zplug update
}

source ~/.zplug/init.zsh

# the shell starts slow if this file does not exist
[ -f $ZPLUG_LOADFILE ] || touch $ZPLUG_LOADFILE

zplug "junegunn/fzf-bin",                        from:gh-r, as:command, rename-to:fzf, use:"*linux*amd64*"
zplug "bhilburn/powerlevel9k",                   use:powerlevel9k.zsh-theme, as:theme
zplug "tarruda/zsh-autosuggestions"
zplug "zdharma/fast-syntax-highlighting",        defer:2
zplug "lib/key-bindings",                        from:oh-my-zsh
zplug "plugins/command-not-found",               from:oh-my-zsh
zplug "RobSis/zsh-completion-generator"
zplug "plugins/emoji",                           from:oh-my-zsh
zplug "plugins/colored-man-pages",               from:oh-my-zsh
zplug "modules/ssh",                             from:prezto
zplug "modules/completion",                      from:prezto
zplug "plugins/golang",                          from:oh-my-zsh
zplug "zsh-users/zsh-completions"

if ! zplug check --verbose; then
    zplug install
fi

zplug load

[ -f ~/.zshrc-local ] && source ~/.zshrc-local
[ -f ~/dotfiles/.zaliases ] && source ~/dotfiles/.zaliases

. ~/dotfiles/zsh_conf/fzf

# history search
if zplug check zsh-users/zsh-history-substring-search; then
    bindkey '\eOA' history-substring-search-up
    bindkey '\eOB' history-substring-search-down
fi

zstyle ':prezto:module:autosuggestions' color 'yes'

if [[ -d ~/dotfiles/functions ]]; then
   for func in $(find ~/dotfiles/functions -type f -exec realpath {} +); do
      unhash -f $func 2>/dev/null
      autoload +X $func
   done
fi

if [[ -d ~/dotfiles/widgets ]]; then
   for func in $(find ~/dotfiles/widgets -type f -exec realpath {} +); do
      source $func
   done
fi

setopt share_history
